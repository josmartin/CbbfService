<!DOCTYPE html>
<html>
<body>

<form>
ID: <input id="txt1" type="text" name="name" value="1"><br>
Rating: <input id="txt2" type="text" name="city" value="1"><br>
Watermark: <input id="txt3" type="text" name="city" value="0"><br>
<button type="button" onclick="doGetRatingsJournal()">GET JOURNAL</button>
<button type="button" onclick="doGetAllRatings()">GET RATINGS</button>
<button type="button" onclick="doNewRating()">POST RATING</button>
<button type="button" onclick="doTestDatabase()">DATABASE</button>
</form>


<p id="output">HI</p>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
</script>

<script>
function doGetRatingsJournal() {
    $.get('/get/ratingjournal',
		{ watermark: document.getElementById('txt3').value }, 
		getRatingsDone, 
		'json');
}

function getRatingsDone(data) {
	console.log(data);
	var str = 'Current watermark level: ' + data.newWatermark + '<br>';
	for ( var i = 0; i < data.changes.length; i++ ) {
		str += 'ID:' + data.changes[i].id + ' Rating:' + data.changes[i].rating + '<br>';
	}
	document.getElementById('output').innerHTML = str;
}

function doGetAllRatings() {
	$.get('/get/allratings', 
		{}, 
		getAllRatingsDone,
		'json');		
}

function pad(a,b){ return ([1e15]+a).slice(-b); }

function getAllRatingsDone(data) {
	console.log(data);
	var str = 'Current watermark level: ' + data.newWatermark + '<br>';
	for ( var i = 0; i < data.ratings.length; i++ ) {
		var r = data.ratings[i]
		str += 'ID:' + pad(data.ids[i], 3) + '     Ratings:' + r + '<br>';
	}
	document.getElementById('output').innerHTML = str;
}

function doTestDatabase() {

	$.post('/post/testData',
	{},
	function(d) { console.log(d); }, 
	'json');

}

function doNewRating() {

	$.post('/post/newrating',
	{ id: document.getElementById('txt1').value,
	  rating: document.getElementById('txt2').value},
	newRatingDone, 
	'json');

}
function newRatingDone(data) {
	var str = 'New rating (' + data.rating +') added for ID: ' + data.id + 
		' at watermark: ' + data.watermark;
	document.getElementById('output').innerHTML = str;
}

function doGet() { 
    $.get('/post',
  {
	name:document.getElementById('txt1').value,
	city:document.getElementById('txt2').value
  }, function(d) { console.log(d);}, 'json');
}
function doPost() {

	$.post('/post',
	{
		name:document.getElementById('txt1').value,
		city:document.getElementById('txt2').value
	}, function(d) {console.log(d);}, 'json');

}
</script>

</body>
</html>