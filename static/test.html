<!DOCTYPE html>
<html>
<body>

<form>
User:		<input id="USER" 		type="text" value="1"><br>
ID: 		<input id="ID" 			type="text" value="1"><br>
Rating: 	<input id="RATE" 		type="text" value="1"><br>
Watermark:	<input id="WATERMARK" 	type="text" value="0"><br>
<button type="button" onclick="doGetRatingsJournal()">GET JOURNAL</button>
<button type="button" onclick="doGetAllRatings()">GET RATINGS</button>
<button type="button" onclick="doNewRating()">POST RATING</button>
<button type="button" onclick="doGetUserRatings()">USER RATINGS</button>
<button type="button" onclick="doTest()">TEST</button>
</form>


<p id="output">HI</p>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
</script>

<script>
var beerURI = '';
initServiceEndpoint();
function initServiceEndpoint() {
	$.get('/endpoints/beer.service', 
		function(data) { beerURI = data; });		
}


function doGetRatingsJournal() {
    $.get(beerURI + '/get/ratings/journal',
		{ watermark: $('#WATERMARK').val() }, 
		getRatingsJournalDone, 
		'json');
}

function getRatingsJournalDone(data) {
	console.log(data);
	var str = 'Current watermark level: ' + data.newWatermark + '<br>';
	for ( var i = 0; i < data.journal.ids.length; i++ ) {
		str += 'ID:' + data.journal.ids[i] + ' Rating:' + data.journal.ratings[i] + '<br>';
	}
	$('#output').html(str);
}

function doGetAllRatings() {
	$.get(beerURI + '/get/ratings/all', 
		{}, 
		getAllRatingsDone,
		'json');		
}

function doGetUserRatings() {
	$.get(beerURI + '/get/ratings/user', 
		{ userID: $('#USER').val() }, 
		getUserRatingsDone,
		'json');		
}

function getUserRatingsDone(data) {
	console.log(data);
	var str = '';
	for ( var i = 0; i < data.length; i++ ) {
		str += 'ID:' + data[i].id + ' Rating:' + data[i].rating + '<br>';
	}
	$('#output').html(str);
}

function pad(a,b){ return ([1e15]+a).slice(-b); }

function getAllRatingsDone(data) {
	console.log(data);
	var str = 'Current watermark level: ' + data.newWatermark + '<br>';
	for ( var i = 0; i < data.ratings.length; i++ ) {
		var r = data.ratings[i]
		str += 'ID:' + pad(data.ids[i], 3) + '     Ratings:' + r + '<br>';
	}
	$('#output').html(str);
}

function doTestDatabase() {

	$.post(beerURI + '/post/testData',
	{},
	function(d) { console.log(d); }, 
	'json');

}

function doNewRating() {

	$.post(beerURI + '/post/newrating',
	{ 	user: $('#USER').val(),
		id: $('#ID').val(),
		rating: $('#RATE').val()},
	newRatingDone, 
	'json');

}
function newRatingDone(data) {
	var str = 'New rating (' + data.rating +') added for ID: ' + data.id + 
		' at watermark: ' + data.watermark;
	$('#output').html(str);
}

</script>

</body>
</html>